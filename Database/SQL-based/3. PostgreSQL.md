# PostgreSQL

* **PostgreSQL** (Postgres) là hệ quản trị cơ sở dữ liệu quan hệ (RDBMS) mã nguồn mở, ra đời từ những năm 1986 tại Đại học California, Berkeley.
* Khác với MySQL/MariaDB, PostgreSQL nổi tiếng về:

  * **Tuân thủ chuẩn SQL** rất cao.
  * Hỗ trợ **tính năng nâng cao**: transaction ACID mạnh, trigger, view, stored procedure, JSONB, full-text search.
  * Có khả năng mở rộng (extension như PostGIS cho dữ liệu địa lý).
* Được dùng rộng rãi trong doanh nghiệp, ứng dụng web quy mô lớn, hệ thống phân tích dữ liệu.


# 1. Kiến trúc PostgreSQL

PostgreSQL có mô hình server–client, chia thành:

1. **Postgres Server (postmaster):**

   * Quản lý kết nối, tiến trình con.
   * Quản lý transaction, buffer cache, WAL (Write-Ahead Logging).

2. **Query Processing Layer (SQL Engine):**

   * Parser → phân tích câu lệnh SQL.
   * Rewriter → xử lý rule/trigger.
   * Optimizer → tạo execution plan.
   * Executor → chạy query.

3. **Storage Layer:**

   * Lưu trữ table, index, data file.
   * WAL để đảm bảo tính toàn vẹn (crash recovery).
   * Hỗ trợ nhiều **index type** (B-Tree, Hash, GIN, GiST, BRIN).

# 2. Database mặc định trong PostgreSQL (quan trọng cho Pentest)

* **`postgres`** → database mặc định khi cài.
* **`template0` và `template1`** → template để tạo database mới.
* **`information_schema`** → metadata chuẩn SQL (danh sách DB, bảng, cột).
* **`pg_catalog`** → hệ thống catalog nội bộ (role, quyền, extension).
* **`pg_toast`** → quản lý dữ liệu lớn (TOAST = The Oversized-Attribute Storage Technique).

Khi pentest, thường dùng:

```sql
\l                      -- liệt kê databases (psql)
\dt                     -- liệt kê tables trong DB hiện tại
SELECT datname FROM pg_database;
SELECT usename, passwd FROM pg_shadow; -- nếu có quyền
SELECT table_name FROM information_schema.tables WHERE table_schema='public';
```
# 3. Câu lệnh cơ bản 

### Liệt kê database:

```sql
SELECT datname FROM pg_database;
```

### Chọn DB để sử dụng (trong `psql`):

```sql
\c target_db
```

### Liệt kê bảng:

```sql
\dt
-- hoặc
SELECT table_name FROM information_schema.tables WHERE table_schema='public';
```

### Liệt kê cột:

```sql
SELECT column_name FROM information_schema.columns WHERE table_name='users';
```

### Dump dữ liệu:

```sql
SELECT username, password FROM users;
```
# 4. Ứng dụng PostgreSQL trong Website

* **Frameworks & Web apps:**

  * Django (Python) – PostgreSQL là DB khuyến nghị mặc định.
  * Ruby on Rails – hỗ trợ tốt.
  * Java (Spring, Hibernate) – tích hợp mạnh.
* **CMS / E-commerce:**

  * Drupal, Magento có thể chạy với PostgreSQL.
* **Cloud Services:**

  * AWS RDS, Google Cloud SQL, Heroku Postgres – dùng PostgreSQL rất phổ biến.
* **Use-case đặc biệt:**

  * **PostGIS** extension cho dữ liệu GIS (bản đồ, định vị).
  * Hệ thống tài chính/IoT cần tính toàn vẹn transaction cao.

# 5. Bảo mật & Lỗ hổng thường gặp

* **SQL Injection (SQLi)** → phổ biến trên web app dùng PostgreSQL.
* **Weak password / role misconfig** → user `postgres` mặc định hoặc role có quyền superuser.
* **pg\_shadow / pg\_authid exposure** → chứa hash mật khẩu.
* **Privilege escalation** → user web có quyền đọc catalog (pg\_catalog) hoặc thực thi function nguy hiểm.
* **Misconfiguration**:

  * Service lắng nghe trên `0.0.0.0:5432` mà không có firewall.
  * Cho phép `trust` trong `pg_hba.conf` → login không cần mật khẩu.
* **Extension abuse**: Một số extension (plpgsql, dblink, file\_fdw) có thể bị lạm dụng để đọc file hệ thống hoặc kết nối ra ngoài.
# 6. danh sách câu lệnh.
- https://www.postgresql.org/docs/current/sql-commands.html
- https://learnsql.com/blog/postgresql-cheat-sheet/
- https://www.dbdocs.net/postgresql/commonly-used-postgresql-commands


