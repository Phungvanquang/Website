# MSSQL
Ok üëç m√¨nh s·∫Ω ƒëi s√¢u v√†o **MSSQL (Microsoft SQL Server)**, tr√¨nh b√†y theo ƒë√∫ng **format** nh∆∞ b·∫°n y√™u c·∫ßu ‚Äî ph√π h·ª£p cho h·ªçc t·∫≠p v√† pentest.

---

# üóÇ MSSQL ‚Äì T·ªïng quan

### üîπ Kh√°i ni·ªám

* **MSSQL (Microsoft SQL Server)** l√† h·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu quan h·ªá (RDBMS) do Microsoft ph√°t tri·ªÉn.
* D√πng ng√¥n ng·ªØ **T-SQL (Transact-SQL)**, m·ªü r·ªông t·ª´ chu·∫©n SQL ANSI.
* ƒê∆∞·ª£c t√≠ch h·ª£p m·∫°nh m·∫Ω v·ªõi h·ªá sinh th√°i Microsoft: **Windows Server, Active Directory, IIS, .NET**.
* C√≥ nhi·ªÅu phi√™n b·∫£n (Express, Standard, Enterprise) ph·ª•c v·ª• t·ª´ ·ª©ng d·ª•ng nh·ªè ƒë·∫øn h·ªá th·ªëng doanh nghi·ªáp l·ªõn.

üëâ MSSQL th∆∞·ªùng d√πng trong **h·ªá th·ªëng doanh nghi·ªáp, ERP, CRM, ·ª©ng d·ª•ng web ASP.NET**.

---

# üóÇ 1. Ki·∫øn tr√∫c MSSQL

MSSQL c√≥ ki·∫øn tr√∫c **client-server** r√µ r√†ng, g·ªìm:

1. **SQL Layer**

   * Parser (ph√¢n t√≠ch c√¢u l·ªánh SQL).
   * Optimizer (t·ªëi ∆∞u execution plan).
   * Query processor.

2. **Storage Engine**

   * L∆∞u d·ªØ li·ªáu trong **Data files (`.mdf`, `.ndf`)** v√† **Log file (`.ldf`)**.
   * Qu·∫£n l√Ω page (8KB), extent, b·∫£ng, index.
   * H·ªó tr·ª£ **transaction ACID** v·ªõi locking & latching.

> ƒêi·ªÉm m·∫°nh: t·ªëi ∆∞u cho multi-user, concurrency cao, t√≠ch h·ª£p Windows Authentication.

---

# üóÇ 2. Database m·∫∑c ƒë·ªãnh trong MSSQL (quan tr·ªçng cho Pentest)

M·∫∑c ƒë·ªãnh khi c√†i ƒë·∫∑t MSSQL c√≥ 4 database h·ªá th·ªëng ch√≠nh:

* **`master`** ‚Üí metadata c·ªßa server (login, c·∫•u h√¨nh, linked servers).
* **`msdb`** ‚Üí qu·∫£n l√Ω job, backup, SQL Agent.
* **`tempdb`** ‚Üí database t·∫°m (b·∫£ng t·∫°m, sort, temp objects). Reset m·ªói l·∫ßn restart.
* **`model`** ‚Üí template cho database m·ªõi.

üìå Ngo√†i ra: `Resource DB` (·∫©n, ch·ª©a system objects).

V√≠ d·ª• pentest th∆∞·ªùng l·∫•y th√¥ng tin t·ª´:

```sql
SELECT name FROM sys.databases;   -- Li·ªát k√™ database
SELECT name FROM sysobjects;      -- Li·ªát k√™ object (b·∫£ng, view, proc) trong DB hi·ªán t·∫°i
SELECT * FROM master..syslogins;  -- L·∫•y user login (c·∫ßn quy·ªÅn)
```

---

# üóÇ 3. C√¢u l·ªánh c∆° b·∫£n (Website & Pentest)

### Li·ªát k√™ database:

```sql
SELECT name FROM sys.databases;
```

### Li·ªát k√™ b·∫£ng trong DB hi·ªán t·∫°i:

```sql
SELECT name FROM sysobjects WHERE xtype='U';  -- U = User table
```

### Li·ªát k√™ c·ªôt trong b·∫£ng:

```sql
SELECT name, collation_name 
FROM sys.columns 
WHERE object_id = OBJECT_ID('users');
```

### Dump d·ªØ li·ªáu (v√≠ d·ª• user/pass):

```sql
SELECT username, password FROM users;
```

### L·∫•y version / th√¥ng tin server:

```sql
SELECT @@version;
SELECT SUSER_NAME();   -- user hi·ªán t·∫°i
SELECT DB_NAME();      -- DB hi·ªán t·∫°i
```

---

# üóÇ 4. ·ª®ng d·ª•ng MSSQL trong Website

* **Doanh nghi·ªáp**: ERP (SAP, Dynamics), CRM, c√°c ·ª©ng d·ª•ng k·∫ø to√°n, qu·∫£n l√Ω kho.
* **Web App**: th∆∞·ªùng th·∫•y trong c√°c ·ª©ng d·ª•ng **ASP.NET + IIS + MSSQL**.
* **Business Intelligence**: SQL Server Analysis Services (SSAS), Reporting Services (SSRS), Integration Services (SSIS).
* **Cloud**: Azure SQL Database (PaaS version).

---

# 5. B·∫£o m·∫≠t & L·ªó h·ªïng th∆∞·ªùng g·∫∑p

* **SQL Injection (SQLi)** ‚Üí ph·ªï bi·∫øn tr√™n ASP.NET app n·∫øu kh√¥ng l·ªçc input.
* **xp\_cmdshell abuse** ‚Üí Stored procedure `xp_cmdshell` cho ph√©p ch·∫°y l·ªánh h·ªá th·ªëng (n·∫øu b·∫≠t).
* **Weak/default password** ‚Üí ƒë·∫∑c bi·ªát v·ªõi `sa` account.
* **Linked server abuse** ‚Üí c√≥ th·ªÉ pivot sang server kh√°c.
* **OPENROWSET / BULK INSERT** ‚Üí ƒë·ªçc file t·ª´ filesystem n·∫øu c·∫•u h√¨nh sai.
* **Privilege misconfiguration** ‚Üí user web c√≥ quy·ªÅn qu√° cao (`db_owner`, `sysadmin`).
* **Exposed port 1433** ‚Üí n·∫øu m·ªü public d·ªÖ b·ªã brute-force / exploit.

