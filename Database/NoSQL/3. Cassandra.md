# Cassandra


Apache Cassandra là một **NoSQL Database dạng Column-Oriented** (cơ sở dữ liệu hướng cột), được phát triển bởi Facebook và sau đó chuyển cho Apache Foundation. Cassandra nổi tiếng với khả năng **xử lý dữ liệu phân tán quy mô lớn**, có tính **scalability (khả năng mở rộng)** và **high availability (khả năng sẵn sàng cao)** mà không có single point of failure.

Ứng dụng chính trong: big data, IoT, hệ thống logging, time-series data, và các ứng dụng cần ghi/đọc với throughput lớn.


## 1. Kiến trúc

Cassandra không giống RDBMS hay MongoDB mà dựa trên **peer-to-peer distributed system**:

* **Cluster**: Gồm nhiều node (máy chủ) kết nối ngang hàng, không có master.
* **Node**: Mỗi node chịu trách nhiệm lưu trữ một phần dữ liệu.
* **Partitioning**: Dữ liệu được chia theo **Partition Key** và phân tán bằng thuật toán **consistent hashing**.
* **Replication**: Hỗ trợ replication theo **Data Center** (multi-DC replication).
* **Gossip Protocol**: Các node giao tiếp để chia sẻ trạng thái.
* **SSTable (Sorted String Table)**: Định dạng file bất biến dùng để lưu dữ liệu trên đĩa.

## 2. Keyspace mặc định

Trong Cassandra, "database" tương ứng với **Keyspace**.

* Keyspace là container chứa các **Column Family (table)**.
* Một số keyspace hệ thống mặc định:

  * `system` → quản lý metadata cluster.
  * `system_schema` → thông tin schema.
  * `system_auth` → thông tin người dùng & phân quyền.
  * `system_distributed` → replication metadata.

## 3. Câu lệnh cơ bản (CQL – Cassandra Query Language)

Cassandra không dùng SQL truyền thống mà dùng **CQL**, cú pháp gần giống SQL.

```sql
-- Tạo keyspace
CREATE KEYSPACE mydb
WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 3};

-- Sử dụng keyspace
USE mydb;

-- Tạo bảng
CREATE TABLE users (
    user_id UUID PRIMARY KEY,
    name TEXT,
    email TEXT,
    created_at TIMESTAMP
);

-- Thêm dữ liệu
INSERT INTO users (user_id, name, email, created_at)
VALUES (uuid(), 'Alice', 'alice@example.com', toTimestamp(now()));

-- Truy vấn
SELECT * FROM users WHERE user_id = <UUID>;

-- Cập nhật dữ liệu
UPDATE users SET email = 'newmail@example.com' WHERE user_id = <UUID>;

-- Xoá dữ liệu
DELETE FROM users WHERE user_id = <UUID>;
```

## 3. Ứng dụng thực tế

* **Netflix**: quản lý log và metadata trên hạ tầng toàn cầu.
* **Uber**: lưu trữ dữ liệu GPS và trạng thái tài xế.
* **Instagram**: dùng Cassandra để lưu trữ dữ liệu người dùng và feed.
* **Spotify**: quản lý dữ liệu music catalog và người dùng.

## 4. Bảo mật

* **Authentication**: Hỗ trợ `PasswordAuthenticator`, có thể tích hợp LDAP/Kerberos.
* **Authorization**: Phân quyền theo user, role, keyspace, table.
* **Encryption**: TLS cho client-to-node và node-to-node.
* **Audit Logging**: Ghi log truy cập & thay đổi dữ liệu.
* **Firewall + Network Segmentation**: Giới hạn truy cập chỉ từ dịch vụ nội bộ.
## 5. danh sách câu lệnh.
- https://cassandra.apache.org/doc/latest/cassandra/reference/cql-commands/commands-toc.html
- https://docs.datastax.com/en/cql-oss/3.x/cql/cql_reference/cqlCommandsTOC.html
- https://www.tutorialspoint.com/cassandra/cassandra_shell_commands.html
