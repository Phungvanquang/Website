# Start automatically

#### **1. Khái niệm**

**Restart Policy** quyết định việc container có tự khởi động lại khi dừng hoặc khi Docker daemon khởi động lại hay không.
Cơ chế này giúp đảm bảo các container quan trọng luôn được duy trì chạy liên tục mà không cần can thiệp thủ công.

#### **2. Khi nào dùng**

* Dịch vụ nền như **Nginx**, **PostgreSQL**, **Redis** cần uptime cao.
* Container bị dừng do lỗi (crash) hoặc do host reboot.
* Các môi trường Production, CI/CD pipeline chạy lâu dài.


#### **3. Các chế độ Restart Policy**

| Policy                | Mô tả                                                                    |
| --------------------- | ------------------------------------------------------------------------ |
| **no** *(mặc định)*   | Không tự khởi động lại.                                                  |
| **always**            | Luôn tự khởi động lại, bất kể exit code.                                 |
| **unless-stopped**    | Tự khởi động lại trừ khi bị dừng thủ công (`docker stop`).               |
| **on-failure\[:max]** | Chỉ restart nếu container thoát với mã lỗi ≠ 0 (có thể giới hạn số lần). |


#### **4. Cách cấu hình**

### **CLI**

```bash
# Always restart
docker run -d --restart always nginx

# Restart tối đa 5 lần khi fail
docker run -d --restart on-failure:5 myapp
```

### **Docker Compose**

```yaml
version: "3"
services:
  web:
    image: nginx
    restart: unless-stopped
```

#### **5. Ví dụ thực hành**

```bash
# Tạo container sẽ restart luôn khi bị kill
docker run -d --name test --restart always nginx

# Kill process trong container
docker exec -it test pkill nginx

# Kiểm tra container tự start lại
docker ps
```



#### **6. Lưu ý Production**

* Không dùng `always` cho container thử nghiệm — dễ gây **restart loop**.
* Kết hợp **healthcheck** để tránh restart vô hạn khi lỗi cấu hình.
* Nếu muốn rollback dễ dàng, nên dùng `unless-stopped` thay vì `always`.



#### **7. Tài liệu tham khảo**

* [Docker Docs – Start containers automatically](https://docs.docker.com/config/containers/start-containers-automatically/)


