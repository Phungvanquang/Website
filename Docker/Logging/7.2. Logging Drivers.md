# 7.2. Logging Drivers


##### 1. **Khái niệm**

Logging driver là cơ chế mà Docker sử dụng để thu thập và gửi log từ container đến nơi lưu trữ hoặc hệ thống xử lý log.
Mặc định Docker dùng **`json-file`** driver, lưu log dạng JSON trên máy host.

Cấu hình logging driver:

```bash
docker run --log-driver=<driver_name> [options] <image>
```

Hoặc cấu hình mặc định cho daemon:

```json
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}
```
##### 2. **Các loại logging driver phổ biến**

###### **2.1. `json-file` (mặc định)**

* **Mô tả:** Lưu log container vào file JSON trên host (`/var/lib/docker/containers/<id>/<id>-json.log`).
* **Ưu điểm:**

  * Không cần cấu hình thêm.
  * Dễ đọc bằng `docker logs`.
* **Nhược điểm:**

  * Có thể chiếm nhiều dung lượng nếu không giới hạn.
* **Tùy chọn quan trọng:**

  ```bash
  --log-opt max-size=10m
  --log-opt max-file=3
  ```
###### **2.2. `local`**

* **Mô tả:** Lưu log dạng nhị phân tối ưu cho tốc độ và dung lượng.
* **Ưu điểm:**

  * Nhanh, tiết kiệm dung lượng hơn `json-file`.
* **Nhược điểm:**

  * Không đọc trực tiếp bằng `cat`.
* **Tùy chọn:**

  ```bash
  --log-opt max-size=10m
  --log-opt max-file=5
  ```
###### **2.3. `syslog`**

* **Mô tả:** Gửi log đến syslog daemon (`rsyslog`, `syslog-ng`, `journald`).
* **Ưu điểm:**

  * Tích hợp với hệ thống logging của OS.
  * Hỗ trợ remote syslog server.
* **Nhược điểm:**

  * Cần cấu hình syslog server.
* **Ví dụ:**

  ```bash
  docker run --log-driver=syslog \
             --log-opt syslog-address=udp://192.168.1.100:514 \
             --log-opt tag="{{.Name}}" nginx
  ```
###### **2.4. `fluentd`**

* **Mô tả:** Gửi log đến Fluentd (một log collector phổ biến).
* **Ưu điểm:**

  * Hỗ trợ lọc, xử lý, forward log.
* **Nhược điểm:**

  * Cần Fluentd agent đang chạy.
* **Ví dụ:**

  ```bash
  docker run --log-driver=fluentd \
             --log-opt fluentd-address=localhost:24224 \
             --log-opt tag="{{.Name}}" nginx
  ```
###### **2.5. `splunk`**

* **Mô tả:** Gửi log trực tiếp đến Splunk HTTP Event Collector (HEC).
* **Ưu điểm:**

  * Tích hợp với hệ thống phân tích log mạnh mẽ của Splunk.
* **Nhược điểm:**

  * Yêu cầu license Splunk.
* **Ví dụ:**

  ```bash
  docker run --log-driver=splunk \
             --log-opt splunk-token=xxxxxxxx \
             --log-opt splunk-url=https://splunk.example.com:8088 \
             --log-opt splunk-insecureskipverify=true \
             nginx
  ```
###### **2.6. `gelf`**

* **Mô tả:** Gửi log theo Graylog Extended Log Format (GELF).
* **Ưu điểm:**

  * Tích hợp với Graylog, Logstash.
* **Ví dụ:**

  ```bash
  docker run --log-driver=gelf \
             --log-opt gelf-address=udp://192.168.1.200:12201 \
             nginx
  ```
###### **2.7. `awslogs`**

* **Mô tả:** Gửi log đến Amazon CloudWatch.
* **Ưu điểm:**

  * Tích hợp AWS Cloud.
* **Ví dụ:**

  ```bash
  docker run --log-driver=awslogs \
             --log-opt awslogs-group=my-group \
             --log-opt awslogs-stream=container1 \
             nginx
  ```
###### **2.8. `gcplogs`**

* **Mô tả:** Gửi log đến Google Cloud Logging.
* **Ưu điểm:**

  * Tích hợp GCP.
* **Ví dụ:**

  ```bash
  docker run --log-driver=gcplogs \
             --log-opt gcp-project=my-gcp-project \
             nginx
  ```
###### **2.9. `journald`**

* **Mô tả:** Gửi log đến `systemd-journald`.
* **Ưu điểm:**

  * Tích hợp systemd.
* **Ví dụ:**

  ```bash
  docker run --log-driver=journald nginx
  ```
###### **2.10. `none`**

* **Mô tả:** Tắt hoàn toàn logging.
* **Ưu điểm:**

  * Tiết kiệm tài nguyên.
* **Nhược điểm:**

  * Không thể xem log.
* **Ví dụ:**

  ```bash
  docker run --log-driver=none nginx
  ```
##### 3. **So sánh nhanh**

| Driver    | Local Storage     | Remote Logging  | `docker logs` Support     |
| --------- | ----------------- | --------------- | --------------------------|
| json-file | có                | không           | có                        |
| local     | có                | không           | có                        |
| syslog    | không             | có              | không                     |
| fluentd   | không             | có              | không                     |
| splunk    | không             | có              | không                     |
| gelf      | không             | có              | không                     |
| awslogs   | không             | có              | không                     |
| gcplogs   | không             | có              | không                     |
| journald  | không             | có              | không                     |
| none      | không             | không           | không                     |

