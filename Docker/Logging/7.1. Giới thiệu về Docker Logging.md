# 7.1. Giới thiệu về Docker Logging.md

#### 1. Tổng quan

Trong Docker, **logging** là quá trình thu thập và quản lý thông tin đầu ra (`stdout`) và lỗi (`stderr`) của container.
Mặc định, tất cả dữ liệu mà ứng dụng bên trong container ghi ra `stdout` và `stderr` sẽ được **Docker daemon** xử lý thông qua **logging driver**.

Logging giúp:

* Giám sát hoạt động của ứng dụng.
* Gỡ lỗi (debug) khi container gặp sự cố.
* Lưu trữ dữ liệu để phân tích về sau.
* Tích hợp với hệ thống giám sát tập trung (ELK, Prometheus, Splunk...).
#### 2. Cơ chế ghi log mặc định

* Mặc định, Docker sử dụng **`json-file` logging driver**.
* Log được lưu dưới dạng file JSON tại:

  ```
  /var/lib/docker/containers/<container-id>/<container-id>-json.log
  ```
* Mỗi entry log gồm:

  ```json
  {
    "log": "Nội dung log\n",
    "stream": "stdout",
    "time": "2025-08-13T09:12:23.456789123Z"
  }
  ```
#### 3. Vai trò của Logging Driver

**Logging driver** quyết định cách log được ghi lại và nơi log được gửi đi.

* Một số driver ghi log vào file (json-file, local).
* Một số gửi log tới dịch vụ từ xa (fluentd, syslog, splunk, awslogs...).
* Có thể cấu hình driver mặc định hoặc chỉ định riêng cho từng container:

  ```bash
  docker run --log-driver=syslog nginx
  ```
#### 4. Hạn chế & lưu ý

* **Kích thước file log** có thể tăng rất nhanh nếu không cấu hình **log rotation** (`max-size`, `max-file`).
* Nếu dùng `json-file` hoặc `local` driver, log lưu trên đĩa host → chiếm dung lượng.
* Một số driver không hỗ trợ `docker logs` (ví dụ: `none`, `gelf` gửi thẳng log đi).
* Log có thể chứa thông tin nhạy cảm → cần áp dụng quy tắc bảo mật & ẩn dữ liệu.
#### 5. So sánh các phương pháp ghi log

| Phương pháp            | Ưu điểm                          | Nhược điểm                        |
| ---------------------- | -------------------------------- | --------------------------------- |
| `json-file` (mặc định) | Dễ dùng, hỗ trợ `docker logs`    | Tốn dung lượng, cần xoay vòng log |
| `local`                | Nén log, tiết kiệm hơn json-file | Chỉ hỗ trợ log cục bộ             |
| `syslog`               | Dùng syslog server có sẵn        | Không hỗ trợ `docker logs`        |
| `fluentd`              | Tích hợp dễ với EFK stack        | Cần cấu hình fluentd              |
| `none`                 | Tắt hoàn toàn logging            | Không có log để debug             |
#### 6. Cấu hình mặc định Logging Driver trong daemon

```json
# /etc/docker/daemon.json
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}
```

Sau khi thay đổi:

```bash
sudo systemctl restart docker
```

