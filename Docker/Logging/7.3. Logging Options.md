# 7.3. Logging Options

##### 1. **Mục tiêu**

Customize output giúp bạn:

* Lọc log theo container, mức độ chi tiết, hoặc thời gian.
* Định dạng log để dễ đọc hoặc phân tích bằng tool khác.
* Chuyển log ra file, hệ thống khác, hoặc pipeline xử lý.
##### 2. **Cơ bản: `docker logs`**

Lệnh:

```bash
docker logs [OPTIONS] CONTAINER
```

**Tùy chọn quan trọng:**

* `-f` / `--follow` → theo dõi log real-time (giống `tail -f`).
* `--tail <n>` → chỉ lấy `n` dòng log cuối.
* `--since` → log từ thời điểm nhất định.
* `--until` → log đến thời điểm nhất định.
* `--timestamps` → thêm timestamp vào log.

**Ví dụ:**

```bash
docker logs -f --tail 50 --since 10m my_app
```
##### 3. **Filter & Format Output với `docker ps` và `docker inspect`**

Khi nhiều container, bạn cần lọc ID hoặc tên container để lấy log nhanh hơn.

###### Lọc container theo label:

```bash
docker ps --filter "label=env=prod" --format "{{.Names}}" \
| xargs -I {} docker logs --since 1h {}
```

###### Format log output:

```bash
docker logs my_app | jq -R 'split(" ") | {time:.[0], level:.[1], message:.[2:]}'
```

> `jq` giúp chuyển log thành JSON để xử lý dễ hơn.
##### 4. **Chuyển hướng log ra file**

Bạn có thể redirect output của container ra file log thay vì terminal:

```bash
docker logs my_app &> /var/log/my_app.log
```

Hoặc ghi append:

```bash
docker logs -f my_app >> /var/log/my_app.log
```
##### 5. **Customize qua Logging Driver**

Một số logging driver hỗ trợ tùy chỉnh tag hoặc format log khi gửi ra ngoài.

**Ví dụ với `syslog`:**

```bash
docker run --log-driver=syslog \
           --log-opt tag="{{.ImageName}}/{{.Name}}" \
           nginx
```

Tag có thể chứa:

* `{{.ID}}` → container ID.
* `{{.Name}}` → tên container.
* `{{.ImageName}}` → tên image.
* `{{.DaemonName}}` → tên daemon Docker.
##### 6. **Sử dụng Log Aggregator với định dạng tùy chỉnh**

Bạn có thể dùng `fluentd`, `logstash`, hoặc `vector` để thu log từ Docker và đổi format.

**Ví dụ với Fluentd:**

```bash
docker run --log-driver=fluentd \
           --log-opt tag="app.{{.Name}}" \
           --log-opt fluentd-async-connect=true \
           my_app
```

Sau đó xử lý trong Fluentd:

```conf
<filter app.*>
  @type parser
  format json
</filter>
```
##### 7. **Colorize log để dễ đọc**

```bash
docker logs my_app | ccze -A
```

> `ccze` tô màu log theo level (info, warn, error).
##### 8. **Gộp log từ nhiều container**

```bash
docker ps --format "{{.Names}}" \
| xargs -I {} sh -c 'echo "=== {} ==="; docker logs --tail 20 {}'
```

Hoặc xem log đồng thời:

```bash
multitail -cT ansi $(docker ps -q | xargs -I {} echo "/var/lib/docker/containers/{}/{}-json.log")
```

