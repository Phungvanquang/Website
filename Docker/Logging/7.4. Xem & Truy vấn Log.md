# 7.4. Xem & Truy vấn Log


#### 1. Xem log cơ bản

Docker lưu log mặc định bằng **JSON file** (trừ khi bạn đổi logging driver).
Câu lệnh cơ bản:

```bash
# Xem toàn bộ log
docker logs <container_name_or_id>

# Ví dụ
docker logs myapp
```
#### 2. Theo dõi log theo thời gian thực (tail -f)

```bash
docker logs -f myapp
```

* `-f` (follow) → theo dõi log khi ứng dụng ghi mới.
* Dùng khi debug ứng dụng đang chạy.

#### 3. Giới hạn số dòng log

```bash
# Chỉ lấy 50 dòng cuối
docker logs --tail 50 myapp
```

* Kết hợp `-f`:

```bash
docker logs -f --tail 20 myapp
```
#### 4. Lọc theo thời gian (`--since`, `--until`)

```bash
# Lấy log từ 10 phút trước
docker logs --since 10m myapp

# Lấy log từ một thời điểm cụ thể
docker logs --since "2025-08-13T14:00:00" myapp

# Lấy log đến một thời điểm cụ thể
docker logs --until "2025-08-13T15:00:00" myapp
```

* Thời gian theo chuẩn RFC3339 hoặc relative (10s, 5m, 2h).
#### 5. Lọc nội dung log bằng grep

```bash
# Chỉ lấy log chứa từ "ERROR"
docker logs myapp | grep "ERROR"

# Không phân biệt hoa/thường
docker logs myapp | grep -i "warn"
```

Kết hợp nhiều điều kiện:

```bash
docker logs myapp | grep "ERROR" | grep "database"
```
#### 6. Lọc nâng cao bằng jq (JSON logs)

Nếu driver log là `json-file`, bạn có thể đọc file gốc bằng `jq`:

```bash
# Đường dẫn log container
cat /var/lib/docker/containers/<container_id>/<container_id>-json.log | jq .
```

Ví dụ lấy message chứa “ERROR”:

```bash
jq 'select(.log | contains("ERROR"))' /var/lib/docker/containers/<id>/<id>-json.log
```
#### 7. Tích hợp với less/more để xem log dài

```bash
docker logs myapp | less
```

* Có thể cuộn, tìm kiếm `/keyword`.
#### 8. Tách log stdout và stderr

```bash
# Chỉ stdout
docker logs myapp 1>stdout.log

# Chỉ stderr
docker logs myapp 2>stderr.log
```
#### 9. Kết hợp với công cụ phân tích log

* **grep/awk/sed** → lọc nhanh
* **multitail** → xem nhiều container song song
* **lnav** → xem log có highlight thời gian và pattern
* **jq** → phân tích log JSON

Ví dụ xem log nhiều container:

```bash
docker logs -f web & docker logs -f api
```
#### 10. Best Practices khi xem/truy vấn log

* Luôn xác định **thời gian** và **pattern** để giảm dữ liệu tải.
* Khi debug production, kết hợp `docker inspect` để biết cấu hình log driver.
* Nếu log nhiều → cấu hình **log rotation** trong `daemon.json` để tránh full disk.

