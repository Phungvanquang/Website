# 8.10. Secrets Management


### 1. KhÃ¡i niá»‡m.

Secrets Management lÃ  cÆ¡ cháº¿ báº£o máº­t giÃºp quáº£n lÃ½, lÆ°u trá»¯ vÃ  phÃ¢n phá»‘i **thÃ´ng tin nháº¡y cáº£m** (secrets) nhÆ°:

* Máº­t kháº©u (passwords)
* API keys
* Tokens
* Certificates
* SSH keys

Trong Docker, thay vÃ¬ lÆ°u trá»¯ secrets trá»±c tiáº¿p trong **Dockerfile** hoáº·c **environment variables** (cÃ¡ch nÃ y ráº¥t nguy hiá»ƒm vÃ¬ dá»… bá»‹ lá»™ khi inspect image hoáº·c log), Docker cung cáº¥p cÆ¡ cháº¿ an toÃ n hÆ¡n thÃ´ng qua **Docker Secrets** (trong Docker Swarm) hoáº·c tÃ­ch há»£p vá»›i **cÃ¡c há»‡ thá»‘ng quáº£n lÃ½ secrets chuyÃªn dá»¥ng** (HashiCorp Vault, AWS Secrets Manager, Azure Key Vault, v.v.).

### 2. Hoáº¡t Ä‘á»™ng.

Secrets Management trong Docker chá»§ yáº¿u cÃ³ 2 phÆ°Æ¡ng phÃ¡p:

1. **Docker Secrets (native, trong Swarm mode)**

   * Secrets Ä‘Æ°á»£c lÆ°u trong **Raft log** cá»§a Docker Swarm, Ä‘Æ°á»£c **mÃ£ hÃ³a**.
   * Khi container cáº§n secrets, Docker **mount secrets dÆ°á»›i dáº¡ng file táº¡m thá»i** trong `/run/secrets/`.
   * Chá»‰ container trong **service Ä‘Æ°á»£c cáº¥p quyá»n** má»›i tháº¥y secrets.
   * Secrets khÃ´ng bá»‹ expose trong image hoáº·c env vars.

2. **TÃ­ch há»£p vá»›i Secret Store ngoÃ i** (Vault, AWS, GCP, Azure)

   * Container cÃ³ thá»ƒ láº¥y secrets thÃ´ng qua **API call** hoáº·c agent sidecar.
   * Quáº£n lÃ½ vÃ²ng Ä‘á»i (lifecycle) cá»§a secrets, cÃ³ thá»ƒ **tá»± Ä‘á»™ng rotate**.
   * Cho phÃ©p kiá»ƒm soÃ¡t cháº·t cháº½ hÆ¡n báº±ng **Access Control (RBAC)**.

### 3. **TÃ¡c Ä‘á»™ng báº£o máº­t**

* ğŸ”’ **NgÄƒn lá»™ secrets trong image** â†’ káº» táº¥n cÃ´ng khÃ´ng thá»ƒ láº¥y máº­t kháº©u/API key tá»« image.
* ğŸ”’ **Giáº£m nguy cÆ¡ log/inspect leak** â†’ secrets khÃ´ng xuáº¥t hiá»‡n trong log hoáº·c docker inspect.
* ğŸ”’ **Quáº£n lÃ½ quyá»n truy cáº­p chi tiáº¿t** â†’ chá»‰ container/service Ä‘Æ°á»£c phÃ©p má»›i cÃ³ secrets.
* ğŸ”’ **Dá»… dÃ ng rotate** â†’ thay Ä‘á»•i secrets mÃ  khÃ´ng cáº§n rebuild image.

Náº¿u khÃ´ng dÃ¹ng secrets management Ä‘Ãºng cÃ¡ch (vÃ­ dá»¥ hard-code máº­t kháº©u trong Dockerfile), attacker cÃ³ thá»ƒ **reverse image** vÃ  láº¥y Ä‘Æ°á»£c thÃ´ng tin nháº¡y cáº£m.
### 4. PhÃ¢n tÃ­ch trong Layer Security (Docker Security Model).

* **Host Security**: Secrets Ä‘Æ°á»£c lÆ°u trong **Swarm manager nodes** vÃ  Ä‘Æ°á»£c mÃ£ hÃ³a â†’ host bá»‹ táº¥n cÃ´ng khÃ³ láº¥y plaintext secrets.
* **Container Security**: Secrets chá»‰ Ä‘Æ°á»£c mount vÃ o container trong runtime â†’ náº¿u container khÃ´ng cÃ³ quyá»n, nÃ³ khÃ´ng tháº¥y secrets.
* **Image Security**: Secrets khÃ´ng náº±m trong Dockerfile â†’ khÃ´ng bá»‹ bake cá»©ng vÃ o image.
* **Orchestration Security**: Quáº£n lÃ½ phÃ¢n phá»‘i secrets qua Swarm/Kubernetes hoáº·c cÃ¡c secret stores â†’ kiá»ƒm soÃ¡t truy cáº­p táº­p trung.

### 5. VÃ­ dá»¥ minh há»a.

**Táº¡o secret trong Docker Swarm**:

```bash
# Khá»Ÿi táº¡o Swarm (náº¿u chÆ°a cÃ³)
docker swarm init

# Táº¡o secret
echo "my_super_secret_password" | docker secret create db_pass -

# Liá»‡t kÃª secret
docker secret ls
```

**Sá»­ dá»¥ng secret trong service**:

```bash
docker service create \
  --name mydb \
  --secret db_pass \
  mysql:latest
```

Trong container MySQL, secret sáº½ Ä‘Æ°á»£c mount táº¡i:

```bash
/run/secrets/db_pass
```

â†’ á»¨ng dá»¥ng chá»‰ cáº§n Ä‘á»c file nÃ y Ä‘á»ƒ láº¥y máº­t kháº©u.


