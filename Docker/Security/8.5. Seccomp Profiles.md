# 8.5. Seccomp Profiles


### 1. Kh√°i ni·ªám

* **Seccomp (Secure Computing Mode)** l√† m·ªôt t√≠nh nƒÉng c·ªßa Linux Kernel cho ph√©p h·∫°n ch·∫ø t·∫≠p l·ªánh **system calls** (syscalls) m√† ti·∫øn tr√¨nh trong container c√≥ th·ªÉ th·ª±c hi·ªán.
* Trong Docker, **Seccomp Profile** l√† m·ªôt t·ªáp JSON ƒë·ªãnh nghƒ©a danh s√°ch syscalls n√†o ƒë∆∞·ª£c:

  * Cho ph√©p (**allow**)
  * T·ª´ ch·ªëi (**deny**)
  * Tr·∫£ v·ªÅ l·ªói (**errno**)
  * Gi·∫øt ti·∫øn tr√¨nh (**kill**)
* Docker m·∫∑c ƒë·ªãnh cung c·∫•p m·ªôt **profile chu·∫©n** ch·∫∑n kho·∫£ng **44 system calls nguy hi·ªÉm** (v√≠ d·ª•: `keyctl`, `ptrace`, `kexec_load`, `mount`, ‚Ä¶).
### 2. C√°ch ho·∫°t ƒë·ªông

* Khi container ƒë∆∞·ª£c kh·ªüi ch·∫°y, Docker Daemon g·ª≠i Seccomp profile xu·ªëng kernel.
* Kernel s·ª≠ d·ª•ng **Berkeley Packet Filter (BPF)** ƒë·ªÉ √°p d·ª•ng b·ªô l·ªçc syscalls.
* N·∫øu container g·ªçi m·ªôt syscall b·ªã c·∫•m trong profile ‚Üí kernel s·∫Ω t·ª´ ch·ªëi ngay l·∫≠p t·ª©c.

üëâ Lu·ªìng ho·∫°t ƒë·ªông:

```
Container process ‚Üí Syscall ‚Üí Kernel Seccomp Filter ‚Üí 
    ‚úî Cho ph√©p n·∫øu h·ª£p l·ªá
    ‚úò Ch·∫∑n/n√©m l·ªói n·∫øu b·ªã c·∫•m
```

---

### 3. T√°c ƒë·ªông

* **Gi·∫£m b·ªÅ m·∫∑t t·∫•n c√¥ng**: h·∫°n ch·∫ø quy·ªÅn c·ªßa container, kh√¥ng th·ªÉ g·ªçi ƒë·∫øn c√°c syscalls nguy hi·ªÉm li√™n quan t·ªõi kernel exploit.
* **·ªîn ƒë·ªãnh**: container kh√¥ng l√†m crash kernel do syscalls nguy hi·ªÉm.
* **Ki·ªÉm so√°t chi ti·∫øt**: b·∫°n c√≥ th·ªÉ vi·∫øt Seccomp profile ri√™ng ƒë·ªÉ ph√π h·ª£p v·ªõi workload (VD: ch·∫∑n `clone()` ƒë·ªÉ ngƒÉn fork bomb).
* **Gi·ªõi h·∫°n**: n·∫øu qu√° kh·∫Øt khe, ·ª©ng d·ª•ng trong container c√≥ th·ªÉ kh√¥ng ch·∫°y ƒë∆∞·ª£c (VD: ch·∫∑n `openat` ‚Üí container kh√¥ng th·ªÉ m·ªü file).

---

### 4. Ph√¢n t√≠ch k·ªπ thu·∫≠t

* Docker m·∫∑c ƒë·ªãnh b·∫≠t Seccomp tr√™n Linux n·∫øu kernel h·ªó tr·ª£.

* C√°ch ki·ªÉm tra Seccomp tr√™n container:

  ```bash
  docker run --rm alpine:latest grep Seccomp /proc/1/status
  ```

  ‚Üí Tr·∫£ v·ªÅ `Seccomp: 2` nghƒ©a l√† ƒëang ch·∫°y ch·∫ø ƒë·ªô **seccomp filter**.

* Ch·∫°y container v·ªõi profile t√πy ch·ªânh:

  ```bash
  docker run --rm \
    --security-opt seccomp=/path/to/profile.json \
    alpine:latest
  ```

* Ch·∫°y container **kh√¥ng c√≥ Seccomp** (nguy hi·ªÉm):

  ```bash
  docker run --rm \
    --security-opt seccomp=unconfined \
    alpine:latest
  ```

* C·∫•u tr√∫c c∆° b·∫£n c·ªßa **Seccomp Profile JSON**:

  ```json
  {
    "defaultAction": "SCMP_ACT_ERRNO",
    "archMap": [
      { "architecture": "SCMP_ARCH_X86_64", "subArchitectures": ["SCMP_ARCH_X86", "SCMP_ARCH_X32"] }
    ],
    "syscalls": [
      {
        "names": ["open", "openat"],
        "action": "SCMP_ACT_ALLOW",
        "args": []
      },
      {
        "names": ["keyctl", "mount", "ptrace"],
        "action": "SCMP_ACT_ERRNO"
      }
    ]
  }
  ```
### 5. Khi n√†o c·∫ßn tu·ª≥ ch·ªânh Seccomp

* Khi b·∫°n ch·∫°y ·ª©ng d·ª•ng nh·∫°y c·∫£m (web server, database, sandbox) c·∫ßn gi·ªõi h·∫°n syscalls.
* Khi mu·ªën **hardening** container production.
* Khi l√†m **Red Team / Pentest** ƒë·ªÉ th·ª≠ bypass syscall filter.



B·∫°n c√≥ mu·ªën m√¨nh vi·∫øt ti·∫øp **8.6. Content Trust & Notary** (b·∫£o m·∫≠t image qua k√Ω s·ªë) kh√¥ng, hay b·∫°n mu·ªën ƒë√†o s√¢u h∆°n v√†o **c√°ch vi·∫øt Seccomp profile t√πy ch·ªânh** tr∆∞·ªõc?
