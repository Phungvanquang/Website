# 8.11. Security Scanning & Compliance.md

**Security Scanning & Compliance** trong Docker ƒë·ªÅ c·∫≠p ƒë·∫øn vi·ªác ki·ªÉm tra, ƒë√°nh gi√° v√† ƒë·∫£m b·∫£o r·∫±ng **images, containers, v√† m√¥i tr∆∞·ªùng Docker** tu√¢n th·ªß c√°c ti√™u chu·∫©n b·∫£o m·∫≠t v√† quy ƒë·ªãnh (compliance standards). M·ª•c ti√™u ch√≠nh l√†:

* Ph√°t hi·ªán **l·ªó h·ªïng b·∫£o m·∫≠t (vulnerabilities)** trong Docker image v√† container.
* ƒê·∫£m b·∫£o h·ªá th·ªëng tu√¢n th·ªß c√°c **chu·∫©n b·∫£o m·∫≠t** (CIS Benchmark, NIST, PCI-DSS, HIPAA, ISO 27001, v.v.).
* Gi·∫£m thi·ªÉu r·ªßi ro t·ª´ **misconfiguration** ho·∫∑c **software supply chain attacks**.

### 1. Kh√°i ni·ªám

* **Security Scanning**: Qu√©t images, containers, v√† c√°c th√†nh ph·∫ßn (dependencies, libraries, packages) ƒë·ªÉ t√¨m **CVE (Common Vulnerabilities and Exposures)** ƒë√£ bi·∫øt.
* **Compliance**: ƒê·∫£m b·∫£o Docker host, daemon, container, network, v√† image tu√¢n theo **ch√≠nh s√°ch b·∫£o m·∫≠t** (security policy) v√† **c√°c benchmark chu·∫©n h√≥a** (v√≠ d·ª• CIS Docker Benchmark).

### 2. C√°c l·ªõp Scanning

#### a. Image Scanning

* Qu√©t **Docker image** ƒë·ªÉ t√¨m:

  * L·ªó h·ªïng trong OS packages (glibc, openssl, bash‚Ä¶).
  * L·ªó h·ªïng trong **application dependencies** (pip, npm, gem, maven‚Ä¶).
  * C·∫•u h√¨nh nguy hi·ªÉm (v√≠ d·ª• image ch·∫°y b·∫±ng root).

C√¥ng c·ª•: **Trivy, Clair, Anchore, Docker Hub Scan, Harbor Scanner.**
#### b. Container Runtime Scanning

* Gi√°m s√°t container ƒëang ch·∫°y:

  * Ph√°t hi·ªán **process b·∫•t th∆∞·ªùng**.
  * Ph√°t hi·ªán **file h·ªá th·ªëng b·ªã thay ƒë·ªïi**.
  * Ph√°t hi·ªán container **tho√°t ra kh·ªèi sandbox** (privilege escalation).

C√¥ng c·ª•: **Falco, Aqua Security Runtime Protection, Sysdig Secure.**

#### üîπ c. Host & Daemon Compliance

* Ki·ªÉm tra c·∫•u h√¨nh **Docker Daemon** v√† **Host OS**:

  * Daemon c√≥ ch·∫°y TLS hay kh√¥ng.
  * Seccomp profile c√≥ ƒë∆∞·ª£c b·∫≠t.
  * User namespace c√≥ ƒë∆∞·ª£c d√πng.
  * Kernel parameter c√≥ an to√†n kh√¥ng.

C√¥ng c·ª•: **Docker Bench for Security (CIS Benchmark Automation).**
### 3. C√°c C√¥ng c·ª• Ch√≠nh

#### a. **Trivy (Aqua Security)**

* Qu√©t Docker image, container, filesystem, Git repo.
* T√¨m CVE trong c·∫£ OS package v√† application dependencies.
* H·ªó tr·ª£ **misconfiguration detection** (YAML, Terraform, Kubernetes).

```bash
trivy image nginx:latest
```
#### b. **Clair (CoreOS)**

* D√πng database CVE t·ª´ NVD.
* Ho·∫°t ƒë·ªông theo m√¥ h√¨nh client-server (API).
* Th∆∞·ªùng ƒë∆∞·ª£c t√≠ch h·ª£p v·ªõi **Harbor Registry**.
#### c. **Anchore**

* Ph√¢n t√≠ch s√¢u image layers.
* C√≥ ch√≠nh s√°ch compliance (policy-based).
* D√πng trong CI/CD pipelines.
#### d. **Docker Bench for Security**

* Script t·ª± ƒë·ªông ki·ªÉm tra Docker host theo **CIS Benchmark**.
* Output ra danh s√°ch ‚ÄúPASS / WARN / FAIL‚Äù ƒë·ªÉ admin fix.

```bash
docker run -it --net host --pid host --cap-add audit_control \
  -v /var/lib:/var/lib -v /var/run/docker.sock:/var/run/docker.sock \
  docker/docker-bench-security
```
#### e. **Falco (Sysdig)**

* Ph√°t hi·ªán h√†nh vi runtime b·∫•t th∆∞·ªùng.
* V√≠ d·ª•: container c·ªë g·∫Øng ch·∫°y `nc` ƒë·ªÉ m·ªü reverse shell ‚Üí c·∫£nh b√°o.
### 4. Compliance Standards cho Docker

C√°c chu·∫©n ph·ªï bi·∫øn √°p d·ª•ng khi ƒë√°nh gi√° container & Docker host:

* **CIS Docker Benchmark** ‚Üí H∆∞·ªõng d·∫´n hardening Docker.
* **NIST 800-190** ‚Üí Security Guidelines for Containerized Applications.
* **PCI-DSS** ‚Üí B·∫£o m·∫≠t d·ªØ li·ªáu th·∫ª khi d√πng Docker.
* **HIPAA** ‚Üí Tu√¢n th·ªß b·∫£o m·∫≠t d·ªØ li·ªáu y t·∫ø trong containers.
### 5. Quy tr√¨nh Tri·ªÉn khai

1. **Qu√©t image trong CI/CD** ‚Üí kh√¥ng cho ph√©p push image c√≥ l·ªó h·ªïng n·∫∑ng (High/Critical CVE).
2. **Qu√©t registry** (Harbor, Docker Hub, ECR, GCR) ‚Üí t·ª± ƒë·ªông ph√°t hi·ªán image ch·ª©a l·ªó h·ªïng.
3. **√Åp d·ª•ng Docker Bench for Security** tr√™n host ‚Üí ƒë·∫£m b·∫£o daemon & OS an to√†n.
4. **Gi√°m s√°t runtime b·∫±ng Falco/Aqua** ‚Üí ph√°t hi·ªán container b·ªã exploit.
5. **B√°o c√°o compliance** ‚Üí ph·ª•c v·ª• audit v√† ch·ª©ng nh·∫≠n (PCI-DSS, ISO 27001‚Ä¶).
### 6. T√°c ƒë·ªông & √ù nghƒ©a

* Gi√∫p ph√°t hi·ªán l·ªó h·ªïng **tr∆∞·ªõc khi tri·ªÉn khai** ‚Üí gi·∫£m nguy c∆° khai th√°c.
* Gi√∫p doanh nghi·ªáp **tu√¢n th·ªß quy ƒë·ªãnh ph√°p l√Ω**.
* TƒÉng t√≠nh minh b·∫°ch v√† tin c·∫≠y c·ªßa **Docker supply chain**.
* Gi·∫£m thi·ªÉu **r·ªßi ro runtime attack** trong m√¥i tr∆∞·ªùng production.



B·∫°n c√≥ mu·ªën m√¨nh l√†m **so s√°nh chi ti·∫øt c√°c c√¥ng c·ª• (Trivy vs Clair vs Anchore vs Docker Bench)** ƒë·ªÉ d·ªÖ l·ª±a ch·ªçn kh√¥ng?
