# 8.9. Read-only Filesystem


### 1. Khái niệm.

* Mặc định, container Docker có thể **đọc và ghi (read-write)** vào filesystem root (`/`) của nó.
* Nếu bật **read-only filesystem**, toàn bộ filesystem gốc sẽ chuyển sang chế độ **read-only**, ngoại trừ:

  * Các **mount volume** hoặc **tmpfs mount** (vẫn cho phép ghi).
  * Điều này buộc ứng dụng trong container phải hoạt động mà **không ghi dữ liệu vào root filesystem**, giúp giảm nguy cơ khai thác hoặc persistence.

Ví dụ:

```bash
docker run --rm -it --read-only nginx
```

→ Container Nginx sẽ chạy với filesystem chỉ đọc.

### 2. Cơ chế hoạt động.

* Docker thực hiện điều này bằng cách **mount filesystem root của container ở chế độ read-only**.
* Khi container cần ghi dữ liệu, ta phải cấp **volume** hoặc **tmpfs mount** rõ ràng.
* Ví dụ:

```bash
docker run -it --read-only \
  -v /app/data \
  --tmpfs /tmp \
  myapp
```

Ở đây:

* `--read-only` → filesystem gốc là read-only.
* `-v /app/data` → mount volume để ứng dụng có thể ghi dữ liệu bền vững.
* `--tmpfs /tmp` → mount tmpfs để ứng dụng có thể ghi dữ liệu tạm thời trong bộ nhớ.

### 3. Lợi ích bảo mật.

1. **Ngăn chặn ghi trái phép**

   * Kẻ tấn công không thể chỉnh sửa file hệ thống, chèn backdoor, hoặc cài binary độc hại vào container.

2. **Giảm thiểu persistence**

   * Dù kẻ tấn công xâm nhập, thay đổi của họ sẽ không tồn tại vì filesystem là read-only.

3. **Giảm bề mặt tấn công**

   * Nhiều kỹ thuật khai thác (ví dụ: ghi file cấu hình, chỉnh sửa script, tạo user) sẽ thất bại.

### 4. Thách thức khi áp dụng.

* **Một số ứng dụng cần ghi log, cache, socket file** → phải mount `tmpfs` hoặc `volume`.
* Nếu không chuẩn bị sẵn mount, ứng dụng có thể crash.
* Do đó, việc bật read-only cần đi kèm với **kiểm thử ứng dụng** để biết chính xác những đường dẫn nào cần ghi.

Ví dụ ứng dụng Node.js:

```bash
docker run -it --read-only \
  --tmpfs /tmp \
  -v node_logs:/var/log \
  mynodeapp
```

### 5. So sánh với các kỹ thuật khác.

* **Seccomp**: kiểm soát syscalls → chặn hành vi nguy hiểm.
* **AppArmor/SELinux**: kiểm soát access đến file, network, capability.
* **Read-only filesystem**: trực tiếp **ngăn ghi filesystem**, đơn giản nhưng cực kỳ hiệu quả.


